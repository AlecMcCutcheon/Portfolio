<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/images/Icon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Professional portfolio showcasing creative works, certifications, and professional background"
    />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Performance optimizations -->
    <link rel="preload" href="%PUBLIC_URL%/images/Profile_Image.webp" as="image" type="image/webp">
    <link rel="preload" href="%PUBLIC_URL%/images/CompTIA_badge.webp" as="image" type="image/webp">
    <link rel="preconnect" href="https://api.github.com" crossorigin>
    <link rel="dns-prefetch" href="https://api.github.com">
    <link rel="preconnect" href="https://api.emailjs.com" crossorigin>
    <link rel="dns-prefetch" href="https://api.emailjs.com">
    
    <!-- Google Analytics 4 - Privacy Sandbox Future-Proof Implementation -->
    <script type="text/javascript">
      // Initialize Google Analytics with Privacy Sandbox compatibility
      let analyticsLoaded = false;
      
      // Check if we're in development environment
      const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      // Privacy-focused configuration for future-proofing
      function loadAnalytics() {
        if (analyticsLoaded) return;
        analyticsLoaded = true;
        
        // Skip analytics in development to avoid MIME type errors
        if (isDevelopment) {
          console.log('Analytics skipped in development environment');
          return;
        }
        
        const script = document.createElement('script');
        script.async = true;
        script.type = 'text/javascript';
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-7Z3DEDL2G8';
        
        // Add error handling for script loading
        script.onerror = function() {
          console.warn('Google Analytics script failed to load');
        };
        
        document.head.appendChild(script);
        
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        window.gtag = gtag;
        
        script.onload = function() {
          try {
            gtag('js', new Date());
            
            // Privacy Sandbox compatible configuration
            gtag('config', 'G-7Z3DEDL2G8', {
              // Core privacy settings
              send_page_view: false,
              anonymize_ip: true,
              allow_google_signals: false,
              allow_ad_personalization_signals: false,
              
              // Privacy Sandbox compatibility
              cookie_flags: 'SameSite=None;Secure',
              custom_map: {
                'custom_parameter_1': 'user_consent'
              },
              
              // Future-proof settings
              enhanced_conversions: false,
              allow_enhanced_conversions: false,
              
              // Performance optimizations
              transport_type: 'beacon',
              use_amp_client_id: false,
              
              // Development environment handling
              debug_mode: false,
              send_page_view: false
            });
            
            // Set consent state for Privacy Sandbox compliance
            gtag('consent', 'default', {
              'analytics_storage': 'denied',
              'ad_storage': 'denied',
              'ad_user_data': 'denied',
              'ad_personalization': 'denied'
            });
            
            // Send page view with minimal data
            gtag('event', 'page_view', {
              page_title: document.title,
              page_location: window.location.href,
              // Add first-party data for better attribution
              custom_parameter_1: 'first_visit'
            });
          } catch (error) {
            console.warn('Google Analytics configuration error:', error);
          }
        };
      }
      
      // Load on user interaction or after 5 seconds (longer delay for privacy)
      // Only load in production environment
      if (!isDevelopment) {
        ['click', 'scroll', 'keydown', 'touchstart'].forEach(event => {
          document.addEventListener(event, loadAnalytics, { once: true, passive: true });
        });
        
        setTimeout(loadAnalytics, 5000);
      }
    </script>
    
    <!-- Error Handling and Script Detection for MIME Type Issues -->
    <script type="text/javascript">
      // Debug: Track all script loading attempts
      console.log('üîç Script Detection: Starting to monitor script loading...');
      
      // Global error handler for script loading issues
      window.addEventListener('error', function(event) {
        if (event.target && event.target.tagName === 'SCRIPT') {
          const src = event.target.src;
          console.log('üö® Script Error Detected:', {
            src: src,
            error: event.message,
            filename: event.filename,
            lineno: event.lineno,
            colno: event.colno
          });
          
          if (src && (src.includes('google-analytics') || src.includes('gtag'))) {
            console.warn('Google Analytics script error handled:', src);
            event.preventDefault();
            return false;
          }
        }
      }, true);
      
      // Handle unhandled promise rejections that might cause MIME type errors
      window.addEventListener('unhandledrejection', function(event) {
        if (event.reason && event.reason.message && 
            event.reason.message.includes('MIME type')) {
          console.warn('MIME type error handled:', event.reason.message);
          event.preventDefault();
        }
      });
      
      // Debug: Monitor all script elements being added to the page
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.tagName === 'SCRIPT' && node.src) {
              console.log('üìú New script detected:', {
                src: node.src,
                type: node.type,
                async: node.async,
                defer: node.defer
              });
              
              // Fix MIME type issue: Ensure all scripts have proper type attribute
              if (!node.type || node.type === '') {
                node.type = 'text/javascript';
                console.log('üîß Fixed MIME type for script:', node.src);
              }
            }
          });
        });
      });
      
      // Fix existing scripts that might already be loaded
      function fixExistingScripts() {
        const scripts = document.querySelectorAll('script[src]');
        scripts.forEach(function(script) {
          if (!script.type || script.type === '') {
            script.type = 'text/javascript';
            console.log('üîß Fixed existing script MIME type:', script.src);
          }
        });
      }
      
      // Start observing when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        // Fix any scripts that were loaded before the observer started
        fixExistingScripts();
        
        // Start monitoring for new scripts
        observer.observe(document.head, { childList: true, subtree: true });
        console.log('üëÄ Script observer started');
        
        // Also check periodically for any scripts that might be missed
        setInterval(fixExistingScripts, 1000);
      });
    </script>
    
    <!-- Google Fonts - Ultra-optimized loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    </noscript>
    
    <title>Alec McCutcheon - Portfolio</title>
    
    <!-- Critical CSS for initial render -->
    <style>
      /* Critical styles to prevent layout shifts */
      html { scroll-behavior: smooth; scroll-padding-top: 40px; }
      body { 
        font-family: 'Inter', system-ui, sans-serif; 
        line-height: 1.6; 
        background-color: #0f172a; 
        color: #f8fafc; 
        margin: 0; 
        padding: 0;
      }
      #root { min-height: 100vh; }
      /* Prevent flash of unstyled content */
      .dark { color-scheme: dark; }
      /* Loading state */
      .loading-placeholder {
        background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html> 